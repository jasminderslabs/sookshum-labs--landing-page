<div class='w-full relative border'>
  <div class='absolute arrow-container justify-center items-center gap-5'>
    <svg
      width='14'
      height='9'
      id='arrow-left'
      viewBox='0 0 14 9'
      fill='none'
      class='w-6 h-6 left-arrow cursor-pointer block'
      xmlns='http://www.w3.org/2000/svg'
      ><path
        fill-rule='evenodd'
        clip-rule='evenodd'
        d='M4.90906 0.265207C4.50324 -0.109399 3.87058 -0.0840962 3.49597 0.321722L0.265201 3.82168C-0.0883963 4.20474 -0.0884 4.79518 0.265194 5.17824L3.49597 8.67828C3.87057 9.08411 4.50323 9.10941 4.90905 8.73481C5.31487 8.36021 5.34018 7.72755 4.96558 7.32173L3.28397 5.49997L13 5.49997C13.5523 5.49997 14 5.05225 14 4.49997C14 3.94768 13.5523 3.49997 13 3.49997L3.284 3.49997L4.96557 1.67829C5.34018 1.27247 5.31487 0.639813 4.90906 0.265207Z'
      ></path></svg
    >

    <svg
      width='14'
      height='9'
      id='arrow-right'
      viewBox='0 0 14 9'
      fill='none'
      class='w-6 h-6 right-arrow cursor-pointer block'
      xmlns='http://www.w3.org/2000/svg'
      ><path
        fill-rule='evenodd'
        clip-rule='evenodd'
        d='M9.09094 0.265207C9.49676 -0.109399 10.1294 -0.0840962 10.504 0.321722L13.7348 3.82168C14.0884 4.20474 14.0884 4.79518 13.7348 5.17824L10.504 8.67828C10.1294 9.08411 9.49677 9.10941 9.09095 8.73481C8.68513 8.36021 8.65982 7.72755 9.03442 7.32173L10.716 5.49997L0.999999 5.49997C0.447714 5.49997 -7.64154e-07 5.05225 -7.86799e-07 4.49997C-8.09444e-07 3.94768 0.447714 3.49997 0.999999 3.49997L10.716 3.49997L9.03443 1.67829C8.65982 1.27247 8.68513 0.639813 9.09094 0.265207Z'
      ></path></svg
    >
  </div>
  <div class='swiper mySwiper'>
    <div class='swiper-wrapper
    h-auto'></div>

    <div class='swiper-pagination'></div>

    <div class='swiper-scrollbar'></div>
  </div>
</div>

<script>
  // import Swiper from "swiper/types/swiper-class";
  import Swiper from "swiper";
  import { Navigation } from "swiper/modules";
  import "swiper/css";
  const cardsData = [
    {
      title: "healthcare",
      content:
        "We develop apps & websites that streamline operations, elevate patient care, and empower healthcare.",
      list: [
        "Telemedicine Platform",
        "Patient Health Management System",
        "Virtual Health Coaching",
      ],
    },
    {
      title: "ecommerce",
      content:
        "We craft user-friendly e-commerce solutions that drive conversions and build customer loyalty.",
      list: [
        "Multi-Channel Retail Platforms",
        "B2B platforms",
        "B2C solutions",
      ],
    },
    {
      title: "Sports",
      content:
        "We design and develop fan-centric sports platforms that drive engagement and connect communities.",
      list: [
        "Fitness Tracking Apps",
        "Personal Training & Coaching Solutions",
        "Activity and Performance Tracking solutions",
      ],
    },
    {
      title: "business solutions",
      content:
        "We craft custom design & development solutions to streamline workflows, boost efficiency, and fuel growth.",
      list: [
        "CRM apps",
        "Project Management apps",
        "Custom Business solutions",
      ],
    },
    {
      title: "on demand solutions",
      content:
        "Craft seamless on demand experiences with our design and development expertise. Get what you need.",
      list: ["Online Classes App", "E-Learning Portals", "School Management"],
    },
  ];

  const swiperWrapper = document.querySelector(".swiper-wrapper");

  // Create slides dynamically
  cardsData.forEach((card) => {
    const slide = document.createElement("div");
    slide.className = "swiper-slide";
    slide.style.height = "auto";

    slide.innerHTML = `
      <div class="bg-[#73737366] p-[1px] h-full grow rounded-[20px] lg:rounded-4xl shrink-0 relative flex flex-col card dark-btn-shadow dropdown-shadow-button
      experience-card hover:bg-linear-to-br! from-[#e6862466] via-transparent to-[#e6862466] select-none card-animate-on-touch">

        <div class="w-full h-full rounded-[20px] bg-[#1c1c1c] lg:rounded-4xl
        px-2.25 pt-2.25 lg:px-3.5 lg:pt-3.5 xl:pt-4! xl:px-4! gap-2 lg:gap-3 xl:gap-4! flex flex-col dark-btn-shadow dropdown-bg dropdown-shadow-button">

          <canvas class="md:h-26 lg:h-28 xl:h-44.75! w-fit h-25 pt-1 pb-2 pl-3"
            height="510"
            width="510"></canvas>

          <div class="w-full text-white flex flex-col justify-end gap-2.5 h-fit p-1 sm:p-4">
            <h3 class="font-medium text-[14px] lg:text-[19px] capitalize" id="exp-title">
              ${card.title}
            </h3>

            <p class="opacity-70 text-[13px] lg:text-base grow shrink-0 " id='exp-content'>
              ${card.content}
            </p>

            <ul class="text-white list-disc pl-4 sm:pl-3 lg:pl-3 font-medium flex flex-col gap-2 text-[14px] lg:text-[14px] xl:text-[18px]! grow">
              ${card.list.map((item) => `<li>${item}</li>`).join("")}
            </ul>
          </div>
        </div>
      </div>
    `;

    swiperWrapper.appendChild(slide);
  });

  const leftArrow = document.getElementById("arrow-left");
  const rightArrow = document.getElementById("arrow-right");
  // Initialize Swiper
  const swiper = new Swiper(".mySwiper", {
    spaceBetween: 20,
    grabCursor: true,
    modules: [Navigation],
    navigation: {
      nextEl: "#arrow-right",
      prevEl: "#arrow-left",
    },

    pagination: {
      el: ".swiper-pagination",
      clickable: true,
    },

    scrollbar: {
      el: ".swiper-scrollbar",
      draggable: true,
    },

    breakpoints: {
      0: { slidesPerView: 1 },
      350: { slidesPerView: 1.2 },
      400: { slidesPerView: 1.2 },
      550: { slidesPerView: 2 },
      739: { slidesPerView: 2.2, spaceBetween: 17 },
      1050: { slidesPerView: 3.3, spaceBetween: 20 },
      1500: { slidesPerView: 3.3, spaceBetween: 20 },
      1700: { slidesPerView: 3.5, spaceBetween: 30 },
    },

    on: {
      slideChange: function () {
        if (swiper.isBeginning) {
          leftArrow.style.fill = "#777e91";
          rightArrow.style.fill = "white";
        } else {
          leftArrow.style.fill = "white";
          rightArrow.style.fill = "#777e91";
        }
      },
    },
  });
  if (swiper.isBeginning) {
    leftArrow.style.fill = "#777e91";
    rightArrow.style.fill = "white";
  } else {
    leftArrow.style.fill = "white";
    rightArrow.style.fill = "#777e91";
  }
  const cards = document.querySelectorAll(".experience-card");

  const imagePaths = [
    { name: "healthcare", imageCount: 60 },
    { name: "e-commerce", imageCount: 70 },
    { name: "sports", imageCount: 40 },
    { name: "business-solutions", imageCount: 100 },
    { name: "on-demand-solutions", imageCount: 60 },
  ];

  const currentFrame = (index, path) => {
    return `industries/${path}/${index.toString().padStart(4, "0")}.webp`;
  };

  cards.forEach((card, index) => {
    const { name, imageCount } = imagePaths[index];
    const canvas = card.querySelector("canvas");
    const ctx = canvas.getContext("2d");

    canvas.width = canvas.offsetWidth;
    canvas.height = canvas.offsetHeight;

    let images = [];
    let frame = 0;
    let animationId = null;

    let isLoaded = false;
    let isAnimating = false;
    let isHovering = false;
    let hasPlayedForward = false;

    const preloadImages = () => {
      const promises = [];

      for (let i = 1; i <= imageCount; i++) {
        const img = new Image();
        img.src = currentFrame(i, name);
        images.push(img);

        promises.push(
          new Promise((resolve) => {
            img.onload = resolve;
            img.onerror = resolve;
          }),
        );
      }

      Promise.all(promises).then(() => {
        isLoaded = true;
        ctx.drawImage(images[0], 0, 0, canvas.width, canvas.height);
      });
    };

    preloadImages();

    const animateForward = () => {
      if (!isLoaded) return;

      isAnimating = true;
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      ctx.drawImage(images[frame], 0, 0, canvas.width, canvas.height);

      if (frame < imageCount - 1) {
        frame++;
        animationId = requestAnimationFrame(animateForward);
      } else {
        hasPlayedForward = true;
        isAnimating = false;
        if (!isHovering) animateReverse();
      }
    };

    const animateReverse = () => {
      if (!isLoaded) return;

      isAnimating = true;
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      ctx.drawImage(images[frame], 0, 0, canvas.width, canvas.height);

      if (frame > 0) {
        frame--;
        animationId = requestAnimationFrame(animateReverse);
      } else {
        hasPlayedForward = false;
        isAnimating = false;
      }
    };

    card.addEventListener("mouseenter", () => {
      isHovering = true;
      if (!isAnimating && !hasPlayedForward) animateForward();
    });

    card.addEventListener("mouseleave", () => {
      isHovering = false;
      if (!isAnimating && hasPlayedForward) animateReverse();
    });

    card.addEventListener("touchstart", () => {
      isHovering = true;
      if (!isAnimating && !hasPlayedForward) animateForward();
    });

    card.addEventListener("touchend", () => {
      isHovering = false;
      if (!isAnimating && hasPlayedForward) animateReverse();
    });
  });
</script>
<style>
  @media screen and (max-width: 450px) {
    .mySwiper {
      padding-left: 24px;
      padding-right: 24px;
    }
  }
  @media screen and (min-width: 451px) and (max-width: 960px) {
    .mySwiper {
      padding-left: 40px;
      padding-right: 40px;
    }
  }
  @media screen and (min-width: 961px) and (max-width: 1024px) {
    .mySwiper {
      padding-left: 60px;
      padding-right: 60px;
    }
  }
  @media screen and (min-width: 1025px) and (max-width: 1280px) {
    .mySwiper {
      padding-left: 80px;
      padding-right: 80px;
    }
  }
  @media screen and (min-width: 1281px) and (min-width: 1281px) {
    .mySwiper {
      padding-left: 160px;
      padding-right: 81px;
    }
  }
  @media screen and (width: 1024px) {
    #exp-title {
      border: 2px solid red;
      font-size: 16px !important;
    }
    #exp-content {
      font-size: 14px !important;
      line-height: 20px !important;
    }
  }
</style>
